# Drag-and-Drop для изменения порядка стикеров

## Реализованная функциональность

### 1. UI (Renderer)
- **Библиотека**: `@dnd-kit/core` и `@dnd-kit/sortable`
- **Компонент**: `SortableGrid.tsx` - перетаскиваемый элемент стикера
- **Интеграция**: `PackViewPage.tsx` - сетка с поддержкой drag-and-drop
- **Визуальный фидбек**: Курсор `grab`/`grabbing`, полупрозрачность при перетаскивании

### 2. Манифест (Main Process)
- **Поле `order`**: Массив имен файлов в желаемом порядке
- **Методы ManifestService**:
  - `updateOrder(order: string[])` - сохранение нового порядка
  - `getOrderedFragments()` - получение фрагментов в правильном порядке
  - `removeFragment()` - обновлен для синхронизации с `order`

### 3. Telegram API
- **Метод `setStickerPositionInSet(fileId, position)`**: Перемещение одного стикера
- **Метод `reorderStickers(packName, desiredOrder)`**: Массовое изменение порядка
  - Получает текущий порядок из Telegram
  - Сравнивает с желаемым порядком
  - Вызывает `setStickerPositionInSet` для каждого несовпадения
  - Задержка 500мс между запросами (лимиты Telegram)

### 4. Алгоритм обновления
При нажатии "Обновить":
1. **Удаление**: Удаляет стикеры, которых нет локально
2. **Добавление**: Загружает новые стикеры
3. **Перемещение**: Если только изменился порядок (без добавления/удаления):
   - Сохраняет порядок в манифест
   - Вызывает `reorderStickers()` для синхронизации с Telegram
   - Показывает количество перемещенных стикеров

### 5. IPC Handlers
- `UPDATE_FRAGMENT_ORDER`: Сохранение порядка в манифест
- `REORDER_STICKERS`: Синхронизация порядка с Telegram
- `GET_FRAGMENTS`: Обновлен для учета порядка из манифеста

## Использование

1. Откройте пак в режиме просмотра
2. Перетащите стикеры в нужном порядке
3. Нажмите "Обновить"
4. Приложение автоматически:
   - Сохранит новый порядок локально
   - Синхронизирует с Telegram API
   - Покажет результат

## Технические детали

- **Активация перетаскивания**: Движение на 8px (предотвращает случайное срабатывание)
- **Индексация Telegram**: Начинается с 0
- **Задержка между запросами**: 500мс (защита от rate limit)
- **Визуальный порядок**: Строго соответствует порядку в манифесте
